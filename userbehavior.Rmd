---
title: "User Behavior"
authoer: "Mingwei Wu"
output: html_notebook
---

# Background
## Data randomly extract 8477 customers and 1048575 values from 2014/11/18 to 2014/12/18 in taobao shopping, including customer_id,items_id,behavior_type,location,items_category.

# Goal
## Generate the model by analysing User-behavior, and reporting the outcome.

# data interpretation
## user_id: randomly int of user
## item_id: item id
## behavior: pv(page view), fav(collection), cart(cart), buy
## item_category: type of category of items

```{r}
library(tidyverse)
library(dplyr)
library(sqldf)
library(scales)
```

```{r}
ub<-read.csv("UserBehavior.csv",header = TRUE,nrow=2000000)
```

```{r}
dim(ub)
```
```{r}
head(ub)
```

```{r}
ub<-ub%>%
  rename(id=X1,
         user_id=X2268318,
         item_id=X2520377,
         behavior=pv,
         item_category=X1511544070)

```
```{r}
head(ub)
```
```{r}
set.seed(1213)
ub<-ub[sample(1:nrow(ub),300000),]
```

```{r}
ub%>%
  ggplot(aes(behavior))+geom_histogram(stat = 'count', binwidth = 50, color='blue',fill='gray') #histogram to show behavior
```
## conducted data with SQL to check duplicated observations.
```{r}
sqldf("select *, count(*)
      from ub
      group by id,user_id,item_id,behavior,item_category
      having count(user_id) > 1") # none of ob is duplicated
```

```{r}
ub%>%
  group_by(user_id)%>%
  count()%>%
  arrange(desc(n)) # calculates 189239 unique customers buy on the website in 300 thousand observations, and one person frequency is 106 at period time of month.
```

```{r}
ub1<-ub%>%
  group_by(behavior)%>%
  count() #counting the amount of behavior type
ub1
```

```{r}
ub2<-ub1%>%
  ungroup(behavior)%>%
  arrange(n)
ub2 
```
```{r}
ub2<-ub2 %>%
  mutate(behavior = factor(behavior, 
                levels = c("buy","cart","fav","pv")),
              cumulative = cumsum(n),
                midpoint = cumulative - n/2,
                labels = paste0(round((n/ sum(n)) * 100, 1), "%"))
ub2
```
```{r}
ub2%>%
  ggplot(aes(x="",y=n,fill=behavior))+geom_bar(width=1,stat = "identity")+
  coord_polar(theta = "y",start=0)+labs(x="",y="", title="customer behavior on web",fill="behavior")+scale_fill_manual(values = c("yellow", "Red", "Green", "Orange"))+theme_void() #pie chart to show the percentage of customer behavior
```

```{r}
ub1 #page_view is 268646 in 300k observations
```
```{r}
unique(ub["user_id"])%>%
  count()  # unique user amount click on website as 189239 in 300000 observations
```
```{r}
PV<-c(268646)
UV<-c(189239)
rate_clicked_person<-PV/UV
page_view<-data.frame(PV,UV,rate_clicked_person)
page_view #page_view is 268646, unique customer amount is 189239, mean of clicked is 1.42 as rate
```

```{r}
cart<-c(16678); fav<-c(8669);buy<-6007
behavior<-c("PV","fav+cart","buy")
quantity<-c(PV,fav+cart,buy)
rate<-c(PV/PV,(fav+cart)/PV,buy/PV)
```
```{r}
rate_shopping<-data.frame(behavior,quantity,rate)
rate_shopping  # only 2.2% of the customer who fished processing of shopping, and 9.0% of page_view is collect goods
```
```{r}
cr<-buy/(fav+cart);percent(cr) #24% of customer add goods to chart and buy
```

```{r}
rate_shopping%>%
  ggplot(aes(behavior,y=rate))+geom_bar(stat="identity",color="blue",fill="white")+coord_flip()+geom_text(aes(label=percent(round(rate,2))))+ggtitle("visualization of conversaion rate")
```

```{r}
vnb<-(PV+cart+fav)-buy;vnb #287986 customer only view the page,including add good to chart, but not buy in 300k observations.
```
```{r}
sqldf("select count(behavior) as total_buy
      from ub
      where behavior ='buy'") #only 6007 as buy amount in 300k observations
```

```{r}
ub%>%
  filter(behavior=="buy")%>%
  group_by(user_id)%>%
  count()%>%
  ungroup()%>%
  summarise(rate_person_buy=mean(n)) #1.05 as the rate of people in buy behavior
```















